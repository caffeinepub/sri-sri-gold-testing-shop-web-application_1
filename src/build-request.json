{
  "kind": "build_request",
  "title": "Fix broken features, remove Serial Number from Appointments, and ensure registered users appear in Owner dashboard",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-25",
      "text": "Fix authentication/authorization so that all feature pages (Test Results lookup, Feedback submit, Appointments booking, Daily Gold Updates view, Owner Dashboard data tabs) work without “Unauthorized”/“Actor not available” runtime errors after a user logs in with the existing username/password system.",
      "target": "both",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "in the application inside all features are not working"
        ]
      },
      "acceptanceCriteria": [
        "After successful Customer login, the following actions work end-to-end without throwing runtime errors: (1) lookup test result by serial number, (2) submit feedback, (3) submit an appointment request, (4) view Daily Gold Updates.",
        "After successful Owner login, Owner Dashboard tabs load without runtime errors: Appointments list, Feedback list, Users list, Test Results manager, Daily Gold Updates manager.",
        "If the backend rejects a call due to authorization, the UI shows a clear English error message explaining the user needs to sign in properly (not a blank screen or generic failure)."
      ]
    },
    {
      "id": "REQ-26",
      "text": "Add backend role/session handshake APIs in backend/main.mo so the frontend can register the current caller principal as either an Owner (admin) or Customer (user) based on the existing username/password flow, enabling AccessControl checks to pass for subsequent canister calls.",
      "target": "backend",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "in the application inside all features are not working"
        ]
      },
      "acceptanceCriteria": [
        "Backend exposes a shared method for customers to establish a session/permission (e.g., verify username/password against stored customers and then grant caller #user permissions).",
        "Backend exposes a shared method for owners to establish a session/permission (verify owner credentials and grant caller admin permissions).",
        "After calling the appropriate handshake method once, subsequent calls to user/admin-protected APIs succeed for that principal according to role."
      ]
    },
    {
      "id": "REQ-27",
      "text": "Update the frontend login flow (frontend/src/pages/LoginPage.tsx) to call the new backend role/session handshake after local username/password validation succeeds, and block navigation to authenticated pages until the handshake succeeds (showing an English error if it fails).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "in the application inside all features are not working"
        ]
      },
      "acceptanceCriteria": [
        "Customer login: on successful local credential validation, the app calls the backend customer-session handshake; only then navigates to /welcome.",
        "Owner login: on successful local credential validation, the app calls the backend owner-session handshake; only then navigates to /owner-dashboard.",
        "If the handshake fails, the user stays on the login page and sees an English error explaining sign-in could not be completed."
      ]
    },
    {
      "id": "REQ-28",
      "text": "Ensure customer registration reliably appears for the owner by persisting new customers in the canister and rendering the Owner “Users Update” list from canister data (not only from localStorage).",
      "target": "both",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "when user has regestered it is not showing"
        ]
      },
      "acceptanceCriteria": [
        "After a customer registers in frontend/src/pages/RegisterPage.tsx, the customer record is saved in the backend canister and the UI shows an English success state (or a detailed English failure reason if the canister call fails).",
        "Owner Dashboard “Users Update” shows customers fetched from the canister and updates after a refresh (or automatically via React Query invalidation).",
        "The owner can see at least: username, mobile number, and registration date for each registered customer from the canister data."
      ]
    },
    {
      "id": "REQ-29",
      "text": "Remove the Serial Number field from the customer Appointments booking form UI and stop requiring users to enter it; keep the appointment submission functional by sending an empty string or a backend-safe placeholder value for serialNumber.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "remove serial no in appointement"
        ]
      },
      "acceptanceCriteria": [
        "frontend/src/pages/AppointmentsPage.tsx no longer displays the “Serial Number / Reference” input.",
        "Submitting an appointment request still succeeds and shows the existing English success toast/message.",
        "No validation error requires a serial number in the appointment booking UI."
      ]
    },
    {
      "id": "REQ-30",
      "text": "Remove Serial Number from appointment displays in the Owner Dashboard Appointments table so it is not shown to the owner in the UI.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "remove serial no in appointement"
        ]
      },
      "acceptanceCriteria": [
        "In the Owner Dashboard appointments tab (frontend/src/pages/owner/OwnerDashboardPage.tsx), the appointments table no longer has a “Serial Number” column and does not render appointment.serialNumber."
      ]
    },
    {
      "id": "REQ-31",
      "text": "Improve error reporting across feature mutations and queries (Appointments, Feedback, Customers) to surface actual canister error details in English instead of generic “Please try again” when a canister call fails.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "recent-messages-4"
        ],
        "quotes": [
          "remaining are showing error"
        ]
      },
      "acceptanceCriteria": [
        "When submitting feedback fails, the toast/alert includes the extracted canister error detail (English).",
        "When submitting an appointment fails, the toast/alert includes the extracted canister error detail (English).",
        "When customer registration fails due to canister call failure, the UI shows an English error with the underlying reason when available (not only a generic message)."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo (no additional backend services).",
    "Do not modify files under frontend/immutablePaths (including frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/main.tsx, and frontend/src/components/ui)."
  ],
  "nonGoals": [
    "Do not redesign the overall UI theme or navigation beyond what is necessary to fix the broken flows and remove the appointment serial number field.",
    "Do not add third-party auth providers, SMS, email, or external databases.",
    "Do not change the Test Results data-entry simplification (Serial Number + Message) except as required to fix runtime errors related to authorization/session."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}